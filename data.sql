-- CSC440 Project: Sample Data Population
-- Team Members: Miles Hollifield, Claire Jeffries
-- This file populates the database with the provided sample data
-- UPDATED: Dates adjusted for November 2025 to avoid expiration issues

-- ============================================================
-- SECTION 1: USER MANAGEMENT DATA
-- ============================================================

-- Insert Users
INSERT INTO USER (username, password_hash, role) VALUES
('jsmith', '$2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy', 'MANUFACTURER'),
('bpsi', '$2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy', 'MANUFACTURER'),
('alee', '$2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy', 'SUPPLIER'),
('jdoe', '$2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy', 'SUPPLIER'),
('bjohnson', '$2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy', 'VIEWER');

-- Insert Manufacturers (matching sample data: MFG001, MFG002)
INSERT INTO MANUFACTURER (manufacturer_id, user_id, name) VALUES
('MFG001', 1, 'Manufacturer 1'),
('MFG002', 2, 'Manufacturer 2');

-- Insert Suppliers (20 = Supplier A, 21 = Supplier B)
INSERT INTO SUPPLIER (supplier_id, user_id, name) VALUES
(20, 3, 'Supplier A'),
(21, 4, 'Supplier B');

-- ============================================================
-- SECTION 2: PRODUCTS
-- ============================================================

-- Insert Products (matching sample data structure)
INSERT INTO PRODUCT (product_id, name, category_id, manufacturer_id, standard_batch_size) VALUES
(100, 'Steak Dinner', 1, 'MFG001', 100),  -- 1 = Dinners
(239, 'Mac & Cheese', 2, 'MFG001', 300),  -- 2 = Sides
(101, 'Steak Dinner', 1, 'MFG002', 50);   -- 1 = Dinners

-- ============================================================
-- SECTION 3: INGREDIENTS
-- ============================================================

-- Insert Ingredients
-- Based on formulation data: which supplier supplies which ingredient
INSERT INTO INGREDIENT (ingredient_id, supplier_id, name, type) VALUES
(101, 20, 'Salt', 'ATOMIC'),
(102, 21, 'Pepper', 'ATOMIC'),
(104, 21, 'Sodium Phosphate', 'ATOMIC'),
(106, 21, 'Beef Steak', 'ATOMIC'),
(108, 20, 'Pasta', 'ATOMIC'),
(201, 21, 'Seasoning Blend', 'COMPOUND'),
(301, 21, 'Super Seasoning', 'COMPOUND');

-- ============================================================
-- SECTION 4: RECIPE PLANS
-- ============================================================

INSERT INTO RECIPE_PLAN (plan_id, product_id, version_number, created_date, is_active) VALUES
(1, 100, 1, '2025-11-01', TRUE),
(2, 239, 1, '2025-11-01', TRUE),
(3, 101, 1, '2025-11-05', TRUE);

-- Insert Recipe Ingredients (from RecipePlanLine table)
INSERT INTO RECIPE_INGREDIENT (plan_id, ingredient_id, quantity_required) VALUES
(1, 106, 6.0),
(1, 201, 0.2),
(1, 101, 0.1),
(2, 101, 0.1),
(2, 102, 2.0),
(2, 108, 1.0),
(3, 106, 6.0),
(3, 201, 0.2),
(3, 101, 0.1);

-- ============================================================
-- SECTION 5: FORMULATIONS
-- ============================================================

-- Insert Formulations (IngredientFormulation table data)
-- Updated effective dates to be current/future
-- Note: For ingredients with multiple formulations, dates are staggered to avoid duplicates
INSERT INTO FORMULATION (formulation_id, ingredient_id, pack_size, unit_price, effective_start_date, effective_end_date) VALUES
(1, 101, 8.0, 20.0, '2025-11-01', '2026-06-30'),
(2, 102, 5.0, 25.0, '2025-11-01', '2026-08-03'),
(3, 104, 8.0, 30.0, '2025-11-01', '2026-06-01'),
(4, 106, 20.0, 100.0, '2025-11-01', '2026-06-30'),
(5, 106, 20.0, 90.0, '2025-11-10', '2026-10-10'),  -- Different start date for 2nd formulation
(6, 108, 10.0, 50.0, '2025-11-01', '2026-05-28'),
(7, 201, 10.0, 5.0, '2025-11-01', '2025-11-15'),    -- End date before formulation 8 starts
(8, 201, 15.0, 5.0, '2025-11-16', '2026-07-25'),    -- Starts day after formulation 7 ends
(9, 301, 6.0, 6.0, '2025-11-01', '2026-06-12');

-- Insert Formulation Materials (FormulationMaterials table data)
INSERT INTO FORMULATION_MATERIAL (formulation_id, material_ingredient_id, quantity_required) VALUES
(7, 101, 0.6),
(7, 102, 1.0),
(8, 101, 1.0),
(8, 102, 1.0),
(9, 101, 0.6),
(9, 102, 1.0),
(9, 104, 1.0);

-- ============================================================
-- SECTION 6: INGREDIENT BATCHES
-- ============================================================

-- Insert Ingredient Batches
-- Note: lot_number will be auto-generated by trigger as ingredientId-supplierId-batchId
-- User provides: ingredient_id, supplier_id, batch_id
-- UPDATED: All dates set to November 2025 and beyond to avoid expiration issues
-- Expiration dates are 6-8 months in the future (May-July 2026)

-- Batches created by suppliers (manufacturer_id = NULL initially)
INSERT INTO INGREDIENT_BATCH (ingredient_id, supplier_id, manufacturer_id, batch_id, quantity, cost_per_unit, expiration_date, received_date) VALUES
-- Salt batches (ingredient 101, Supplier A = supplier_id 20)
(101, 20, NULL, 'B0001', 1000, 2.5, '2026-06-15', '2025-11-01'),
(101, 20, NULL, 'B0002', 500, 2.5, '2026-07-01', '2025-11-10'),
(101, 20, NULL, 'B0003', 500, 2.5, '2026-07-01', '2025-11-10'),

-- Pepper batch (ingredient 102, Supplier B = supplier_id 21)
(102, 21, NULL, 'B0002', 1200, 5.0, '2026-06-15', '2025-11-03'),

-- Sodium Phosphate batch (ingredient 104, Supplier B)
(104, 21, NULL, 'B0003', 250, 3.75, '2026-06-15', '2025-11-05'),

-- Beef Steak batches (ingredient 106 from Supplier B)
(106, 21, NULL, 'B0005', 3000, 5.0, '2026-06-15', '2025-11-12'),
(106, 21, NULL, 'B0006', 600, 4.5, '2026-06-20', '2025-11-10'),

-- Pasta batches (ingredient 108, Supplier A)
(108, 20, NULL, 'B0007', 1000, 5.0, '2026-04-28', '2025-11-01'),
(108, 20, NULL, 'B0008', 6300, 5.0, '2026-06-30', '2025-11-05'),

-- Seasoning Blend batches (201 from Supplier B)
(201, 21, NULL, 'B0003', 100, 0.5, '2026-05-23', '2025-11-12'),
(201, 21, NULL, 'B0001', 150, 0.33, '2026-05-23', '2025-11-12'),

-- Super Seasoning batch (ingredient 301, Supplier B)
(301, 21, NULL, 'B0004', 20, 1.0, '2026-05-30', '2025-11-01');

-- Update manufacturer_id for batches that have been received by manufacturers
-- Based on the sample data, batches consumed by MFG001 and MFG002
UPDATE INGREDIENT_BATCH SET manufacturer_id = 'MFG001' WHERE lot_number IN (
    '101-20-B0001', '101-20-B0002', '102-21-B0002', '104-21-B0003',
    '106-21-B0005', '108-20-B0007', '108-20-B0008', '201-21-B0003', '301-21-B0004'
);

UPDATE INGREDIENT_BATCH SET manufacturer_id = 'MFG002' WHERE lot_number IN (
    '101-20-B0003', '106-21-B0006', '201-21-B0001'
);

-- ============================================================
-- SECTION 7: PRODUCT BATCHES
-- ============================================================

-- Insert Product Batches
-- UPDATED: Production dates set to November 2025 (recent production)
INSERT INTO PRODUCT_BATCH (lot_number, product_id, manufacturer_id, plan_id, batch_id, quantity_produced, total_cost, per_unit_cost, production_date) VALUES
('100-MFG001-B0901', 100, 'MFG001', 1, 'B0901', 500, 15075.0, 30.15, '2025-11-15'),
('239-MFG001-B0101', 239, 'MFG001', 2, 'B0101', 300, 3030.0, 10.10, '2025-11-14'),
('101-MFG002-B0101', 101, 'MFG002', 3, 'B0101', 50, 1354.0, 27.08, '2025-11-13');

-- ============================================================
-- SECTION 8: BATCH CONSUMPTION (TRACEABILITY)
-- ============================================================

-- Consumption for 100-MFG001-B0901 (Steak Dinner batch)
INSERT INTO BATCH_CONSUMPTION (product_batch_lot, ingredient_batch_lot, quantity_consumed) VALUES
('100-MFG001-B0901', '106-21-B0005', 3000),
('100-MFG001-B0901', '201-21-B0003', 100),
('100-MFG001-B0901', '101-20-B0002', 50);

-- Consumption for 239-MFG001-B0101 (Mac & Cheese batch)
INSERT INTO BATCH_CONSUMPTION (product_batch_lot, ingredient_batch_lot, quantity_consumed) VALUES
('239-MFG001-B0101', '108-20-B0007', 300),
('239-MFG001-B0101', '102-21-B0002', 600),
('239-MFG001-B0101', '101-20-B0001', 30);

-- Consumption for 101-MFG002-B0101 (MFG002's Steak Dinner)
INSERT INTO BATCH_CONSUMPTION (product_batch_lot, ingredient_batch_lot, quantity_consumed) VALUES
('101-MFG002-B0101', '106-21-B0006', 300),
('101-MFG002-B0101', '201-21-B0001', 10),
('101-MFG002-B0101', '101-20-B0003', 5);